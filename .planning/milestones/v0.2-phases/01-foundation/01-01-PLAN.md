---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - pnpm-lock.yaml
  - next.config.ts
  - .env.example
autonomous: true
requirements:
  - DEPS-01
  - DEPS-02
  - DEPS-03
  - DEPS-04
  - DEPS-05
  - DEPS-06
  - DEPS-07
  - DOCS-01

must_haves:
  truths:
    - "pnpm install succeeds with drizzle-orm ^0.45.0 and pinned SDK versions"
    - "@madebykav/ai is absent from package.json dependencies and transpilePackages"
    - "next.config.ts includes output: 'standalone'"
    - ".env.example has dev defaults with localhost:5433 DATABASE_URL"
  artifacts:
    - path: "package.json"
      provides: "Updated dependency versions"
      contains: "drizzle-orm.*0.45.0"
    - path: "next.config.ts"
      provides: "Standalone output and cleaned transpilePackages"
      contains: "output: 'standalone'"
    - path: ".env.example"
      provides: "Dev-friendly environment documentation"
      contains: "localhost:5433"
  key_links:
    - from: "package.json"
      to: "pnpm-lock.yaml"
      via: "pnpm install regenerates lockfile"
      pattern: "drizzle-orm"
---

<objective>
Update package.json dependencies (pin SDK versions, bump drizzle-orm, remove @madebykav/ai), configure next.config.ts for standalone output, and update .env.example with dev defaults.

Purpose: Establish the correct dependency tree that all subsequent code changes depend on. drizzle-orm ^0.45.0 must be installed before schema.ts can use pgPolicy(). SDK versions must be pinned before any code referencing new APIs.

Output: Working package.json with clean install, next.config.ts with standalone output, .env.example with dev defaults.
</objective>

<execution_context>
@/Users/kavinda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kavinda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@APP-TEMPLATE-UPDATE-FINAL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update package.json and install dependencies</name>
  <files>package.json, pnpm-lock.yaml</files>
  <action>
Replace the entire package.json with the exact contents from APP-TEMPLATE-UPDATE-FINAL.md section 1. The key changes are:

1. `drizzle-orm`: `"^0.38.4"` -> `"^0.45.0"`
2. `@madebykav/auth`: `"latest"` -> `"^0.2.0"`
3. `@madebykav/db`: `"latest"` -> `"^0.1.0"`
4. `@madebykav/ui`: `"latest"` -> `"^0.1.2"`
5. Remove `"@madebykav/ai": "latest"` entirely from dependencies
6. Keep all devDependencies unchanged

After updating package.json, run `pnpm install` to regenerate pnpm-lock.yaml. Do NOT manually edit the lockfile.

If pnpm install fails due to @madebykav/auth ^0.2.0 or @madebykav/ui ^0.1.2 not being published, note this as a blocker. Do NOT fall back to `latest` -- the pinned versions are a locked decision.
  </action>
  <verify>
Run `pnpm install` and confirm exit code 0 (no errors). Then verify:
- `grep '"@madebykav/ai"' package.json` returns nothing
- `grep 'drizzle-orm' package.json` shows `^0.45.0`
- `grep '@madebykav/auth' package.json` shows `^0.2.0`
  </verify>
  <done>pnpm install succeeds. package.json has drizzle-orm ^0.45.0, pinned SDK versions, and no @madebykav/ai.</done>
</task>

<task type="auto">
  <name>Task 2: Update next.config.ts and .env.example</name>
  <files>next.config.ts, .env.example</files>
  <action>
**next.config.ts** -- Replace contents with the exact spec from APP-TEMPLATE-UPDATE-FINAL.md section 2:

```typescript
import type { NextConfig } from 'next'

const nextConfig: NextConfig = {
  output: 'standalone',
  transpilePackages: ['@madebykav/ui', '@madebykav/auth', '@madebykav/db'],
}

export default nextConfig
```

Key changes: add `output: 'standalone'`, remove `@madebykav/ai` from transpilePackages, remove the comment.

**.env.example** -- Replace contents with the exact spec from APP-TEMPLATE-UPDATE-FINAL.md section 3:

```env
# Database -- the app's own PostgreSQL instance
# Local dev: postgresql://devuser:devpassword@localhost:5433/app_dev
# Production: set by platform admin in stack env vars
DATABASE_URL=postgresql://devuser:devpassword@localhost:5433/app_dev

# GitHub Token -- only needed for pnpm install of @madebykav packages
# Create at: https://github.com/settings/tokens (scope: read:packages)
# Add to ~/.npmrc, NOT to .env.local:
#   echo "//npm.pkg.github.com/:_authToken=YOUR_TOKEN" >> ~/.npmrc
GITHUB_TOKEN=ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Platform URL -- used for logout redirect and links back to portal
PLATFORM_URL=https://madebykav.com

# App identity
NEXT_PUBLIC_APP_NAME=My App
NEXT_PUBLIC_APP_SLUG=my-app
```
  </action>
  <verify>
- `grep "output: 'standalone'" next.config.ts` succeeds
- `grep "@madebykav/ai" next.config.ts` returns nothing
- `grep "localhost:5433" .env.example` succeeds
- `grep "NEXT_PUBLIC_APP_SLUG" .env.example` succeeds
  </verify>
  <done>next.config.ts has standalone output and no @madebykav/ai. .env.example has dev defaults with localhost:5433 and clear documentation.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `pnpm install` exits cleanly (no unresolved deps)
2. `grep -c '@madebykav/ai' package.json next.config.ts` returns 0 for both files
3. `grep "output: 'standalone'" next.config.ts` finds the standalone config
4. `grep "localhost:5433" .env.example` finds the dev default DATABASE_URL
</verification>

<success_criteria>
- pnpm install succeeds with no errors
- package.json contains drizzle-orm ^0.45.0, @madebykav/auth ^0.2.0, @madebykav/db ^0.1.0, @madebykav/ui ^0.1.2
- @madebykav/ai appears in neither package.json nor next.config.ts
- next.config.ts has output: 'standalone'
- .env.example has dev-friendly defaults and clear documentation
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
